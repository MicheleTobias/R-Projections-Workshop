<!DOCTYPE html>
<html lang="en-us" xml:lang="en-us">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Hands-On Tutorial | Coordinate Reference Systems</title>
  <meta name="description" content="2 Hands-On Tutorial | Coordinate Reference Systems" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Hands-On Tutorial | Coordinate Reference Systems" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop-projections" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Hands-On Tutorial | Coordinate Reference Systems" />
  
  
  

<meta name="author" content="Michele Tobias" />


<meta name="date" content="2023-07-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="coordinate-reference-system-crs.html"/>
<link rel="next" href="raster-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>



<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">YOUR WORKSHOP TITLE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#workshop-description"><i class="fa fa-check"></i><b>0.1</b> Workshop Description</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i><b>0.2</b> Learning Objectives</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i><b>0.3</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="coordinate-reference-system-crs.html"><a href="coordinate-reference-system-crs.html"><i class="fa fa-check"></i><b>1</b> Coordinate Reference System (CRS)</a>
<ul>
<li class="chapter" data-level="1.1" data-path="coordinate-reference-system-crs.html"><a href="coordinate-reference-system-crs.html#datum"><i class="fa fa-check"></i><b>1.1</b> Datum</a></li>
<li class="chapter" data-level="1.2" data-path="coordinate-reference-system-crs.html"><a href="coordinate-reference-system-crs.html#projection"><i class="fa fa-check"></i><b>1.2</b> Projection</a></li>
<li class="chapter" data-level="1.3" data-path="coordinate-reference-system-crs.html"><a href="coordinate-reference-system-crs.html#additional-parameters"><i class="fa fa-check"></i><b>1.3</b> Additional Parameters</a></li>
<li class="chapter" data-level="1.4" data-path="coordinate-reference-system-crs.html"><a href="coordinate-reference-system-crs.html#which-crsprojection-should-i-use"><i class="fa fa-check"></i><b>1.4</b> Which CRS/projection should I use?</a></li>
<li class="chapter" data-level="1.5" data-path="coordinate-reference-system-crs.html"><a href="coordinate-reference-system-crs.html#notation-for-coordinate-reference-systems"><i class="fa fa-check"></i><b>1.5</b> Notation for Coordinate Reference Systems</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="coordinate-reference-system-crs.html"><a href="coordinate-reference-system-crs.html#epsg-code"><i class="fa fa-check"></i><b>1.5.1</b> EPSG Code</a></li>
<li class="chapter" data-level="1.5.2" data-path="coordinate-reference-system-crs.html"><a href="coordinate-reference-system-crs.html#proj-string"><i class="fa fa-check"></i><b>1.5.2</b> PROJ String</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="coordinate-reference-system-crs.html"><a href="coordinate-reference-system-crs.html#avoid-a-common-mistake"><i class="fa fa-check"></i><b>1.6</b> Avoid a Common Mistake</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html"><i class="fa fa-check"></i><b>2</b> Hands-On Tutorial</a>
<ul>
<li class="chapter" data-level="2.1" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html#download-the-data"><i class="fa fa-check"></i><b>2.1</b> Download the data</a></li>
<li class="chapter" data-level="2.2" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html#start-r"><i class="fa fa-check"></i><b>2.2</b> Start R</a></li>
<li class="chapter" data-level="2.3" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html#load-the-libraries-well-need."><i class="fa fa-check"></i><b>2.3</b> Load the libraries we’ll need.</a></li>
<li class="chapter" data-level="2.4" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html#set-your-working-directory-to-the-folder-where-you-saved-your-data"><i class="fa fa-check"></i><b>2.4</b> Set your working directory to the folder where you saved your data</a></li>
<li class="chapter" data-level="2.5" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html#read-the-data-into-our-r-session"><i class="fa fa-check"></i><b>2.5</b> Read the data into our R session</a></li>
<li class="chapter" data-level="2.6" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html#indentifying-the-assigned-crs"><i class="fa fa-check"></i><b>2.6</b> Indentifying the Assigned CRS</a></li>
<li class="chapter" data-level="2.7" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html#defining-a-crs"><i class="fa fa-check"></i><b>2.7</b> Defining a CRS</a></li>
<li class="chapter" data-level="2.8" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html#transforming-reprojecting-vector-data"><i class="fa fa-check"></i><b>2.8</b> Transforming / Reprojecting Vector Data</a></li>
<li class="chapter" data-level="2.9" data-path="hands-on-tutorial.html"><a href="hands-on-tutorial.html#plotting-the-data"><i class="fa fa-check"></i><b>2.9</b> Plotting the Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="raster-data.html"><a href="raster-data.html"><i class="fa fa-check"></i><b>3</b> Raster Data</a></li>
<li class="chapter" data-level="4" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>4</b> Conclusion</a></li>
<li class="chapter" data-level="5" data-path="resources-used-to-compile-this-tutorial.html"><a href="resources-used-to-compile-this-tutorial.html"><i class="fa fa-check"></i><b>5</b> Resources Used to Compile this Tutorial:</a></li>
<li class="chapter" data-level="6" data-path="assessment.html"><a href="assessment.html"><i class="fa fa-check"></i><b>6</b> Assessment</a></li>
<li class="divider"></li>
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
  <img alt="CC BY-SA 4.0" src="https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg" style="float: right; padding-right: 10px;" />
</a>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Coordinate Reference Systems</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="hands-on-tutorial" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Hands-On Tutorial<a href="hands-on-tutorial.html#hands-on-tutorial" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Finally, now we’re going to work in R to get some hands-on practice with the concepts we just discussed.</p>
<p>We’ll be working with sp objects today, but you should also know that there are sf objects as well. <a href="https://cran.r-project.org/web/views/Spatial.html">Roger Bivand’s review of spatial data for R</a> is helpful for understading the options for working with spatial data.</p>
<div id="download-the-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Download the data<a href="hands-on-tutorial.html#download-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The data for this workshop is available in the <a href="https://github.com/MicheleTobias/R-Projections-Workshop/tree/master/Data">data folder</a> in this repository, or you can <a href="https://figshare.com/s/f68e06c4177e27d0aa47">download a .zip file from FigShare</a>.</p>
</div>
<div id="start-r" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Start R<a href="hands-on-tutorial.html#start-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Pick the R flavor of your choice - regular R, R Studio, etc. - and start it up. You can either add the commands we’ll be using to a script file to run, or you can just run the lines individually in your console to see how they work. It’s up to you.</p>
</div>
<div id="load-the-libraries-well-need." class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Load the libraries we’ll need.<a href="hands-on-tutorial.html#load-the-libraries-well-need." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TIP: I add to this section as I write my code and need new libraries. Keep them in one place for easy reference.</p>
<pre><code>install.packages(&quot;sf&quot;)

library(&quot;sf&quot;)</code></pre>
</div>
<div id="set-your-working-directory-to-the-folder-where-you-saved-your-data" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Set your working directory to the folder where you saved your data<a href="hands-on-tutorial.html#set-your-working-directory-to-the-folder-where-you-saved-your-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TIP: Windows users, use \ instead of  or switch the direction of the slashes to /… it has to do with escape characters.</p>
<pre><code>setwd(&quot;C:/Workshops/Data&quot;)</code></pre>
<p>Replace C:/Workshops/Data with the path to the folder in which you saved your data.</p>
</div>
<div id="read-the-data-into-our-r-session" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Read the data into our R session<a href="hands-on-tutorial.html#read-the-data-into-our-r-session" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Because “points” by itself is a command and we don’t want confusion, I’ve added “ws.” (WS for watershed) to the front of my variable names.</p>
<p>Most of the vector data formats can be read into r with the <code>st_read</code> function. To see the help files for this function, run <code>?st_read</code> in your console.</p>
<pre><code>ws.points&lt;-st_read(&quot;data/WBDHU8_Points_SF.geojson&quot;)
ws.polygons&lt;-st_read(&quot;data/WBDHU8_SF.geojson&quot;)
ws.streams&lt;-st_read(&quot;data/flowlines.shp&quot;)</code></pre>
<p>Let’s look at the contents of one of the files:</p>
<pre><code>ws.polygons</code></pre>
<p>Note that the output not only shows the data but gives you some metadata as well, such as the geometry type, bounding box (bbox), and the projected CRS, which is “NAD83 / California Albers”.</p>
</div>
<div id="indentifying-the-assigned-crs" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Indentifying the Assigned CRS<a href="hands-on-tutorial.html#indentifying-the-assigned-crs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To see just the coordinate reference system, we can use the crs() command.
Let’s check the CRS for each of our files:</p>
<pre><code>st_crs(ws.points)
st_crs(ws.polygons)
st_crs(ws.streams)</code></pre>
<p>It looks like the streams dataset does not have its CRS defined.</p>
</div>
<div id="defining-a-crs" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Defining a CRS<a href="hands-on-tutorial.html#defining-a-crs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s be clear that the streams data <em>has</em> a CRS, but R doesn’t know what it should be. (Someone may have forgotten to include the .prj file in this shapefile.) You don’t get to decide what you want it to be, but rather figure out what it <em>IS</em> and tell R which coordinate system to use. How do you know which CRS the data has if its not properly defined? Typically, you first ask the person who sent it. If that fails, you can search for another version of the data online to get a file with the correct projection information. Finally, outright guessing can work, but isn’t recommended. We know that the CRS for this data should be EPSG 3309 (because that’s what the instructor saved it as before she deleted the .prj file… shapefiles are not a great exchange format, FYI).</p>
<p>Set the CRS:</p>
<pre><code>ws.streams.3309&lt;-st_set_crs(ws.streams, value=3309) 
</code></pre>
<p>EPSG 3309 = California Albers, NAD 27</p>
<p>Let’s imagine we loaded up our data and find that it shows up on a map in the wrong location. What happened? Someone defined the CRS incorrectly.
How do you fix it? First you figure out what the CRS should be, then you run one of the lines above with the correct CRS definition to fix the file.</p>
</div>
<div id="transforming-reprojecting-vector-data" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Transforming / Reprojecting Vector Data<a href="hands-on-tutorial.html#transforming-reprojecting-vector-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We need to get all our data into the same projection so it will plot together on one map before we can do any kind of spatial process on the data.</p>
<pre><code># transform/reproject vector data
ws.streams.3310&lt;-st_transform(ws.streams.3309, crs=3310)

#   another option: match the CRS of the polygons data
ws.streams.3310&lt;-st_transform(ws.streams.3309, crs=st_crs(ws.polygons))</code></pre>
<p>Let’s check the CRS for each of our files again:</p>
<pre><code>st_crs(ws.points)
st_crs(ws.polygons)
st_crs(ws.streams)</code></pre>
<p>Now they all should match.</p>
</div>
<div id="plotting-the-data" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> Plotting the Data<a href="hands-on-tutorial.html#plotting-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Lets make a map now that all our data is in the same projection. What if we had tried to do this earlier before we fixed out projection definitions and transformed the files into the same projections?</p>
<p>Load up the CA Counties layer to use as reference in a map:</p>
<pre><code>ca.counties&lt;-st_read(&quot;data/CA_Counties.geojson&quot;)</code></pre>
<p>Let’s plot all the data together:</p>
<pre><code>plot(
  ca.counties$geometry, 
  col=&quot;#FFFDEA&quot;, 
  border=&quot;gray&quot;, 
  xlim=st_bbox(ws.polygons)[1:2], 
  ylim=st_bbox(ws.polygons)[3:4], 
  bg=&quot;#dff9fd&quot;,  
  main = &quot;Perennial Streams&quot;,
  sub = &quot;in the San Francisco Bay Watersheds&quot;
  )
plot(ws.streams$geometry, col=&quot;#3182bd&quot;, lwd=1.75, add=TRUE)
plot(ws.points$geometry, col=&quot;black&quot;, pch=20, cex=3, add=TRUE)
plot(ws.polygons$geometry, lwd=2, border=&quot;grey35&quot;, add=TRUE)</code></pre>
<p>Some explanation of the code above for plotting the spatial data:
* <code>xlim/ylim</code> sets the extent. Here I used the numbers from the bounding box of the polygon dataset, but you could put in numbers - remember that this is projected data so lat/long won’t work
* <code>add=TRUE</code> makes the 2nd, 3rd, 4th, etc. datasets plot on the same map as the first dataset you plot - order matters
* <code>col</code> sets the fill color for the geometry
* <code>border</code> sets the outline color (or stroke for users of vector graphics programs)
* <code>bg</code> sets the background color for the plot
* colors can be specified with words like “gray” or html hex codes like #dff9fd</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="coordinate-reference-system-crs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="raster-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/YOUR_REPO/edit/master/02_r-examples.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/YOUR_REPO/blob/master/02_r-examples.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
